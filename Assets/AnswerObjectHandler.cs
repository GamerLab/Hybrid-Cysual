using System.Collections;
using System.Collections.Generic;
using LazyTurtle;
using TMPro;
using UnityEngine;
using UnityEngine.UI;
using static LazyTurtle.GameManager;
namespace LazyTurtle
{
    public class AnswerObjectHandler : MonoBehaviour
    {
        [SerializeField] public bool TrueAnswerObject;
        [SerializeField] public TextMeshProUGUI AnswerText;
        [SerializeField] public GameObject ParticleHit;


        // Start is called before the first frame update
        //void Start()
        //{
        //    if (TrueAnswerObject)
        //    {
        //        //   AnswerText.text = GameHelperManager.HelperInstance.TrueAnswerText.text.ToString();
        //        this.AnswerText.text = GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].Answer1;
        //    }
        //    else
        //    {
        //        this.AnswerText.text = GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].Answer2;
        //    }
        //}
        private void OnEnable()
        {
            if (TrueAnswerObject)
            {
                //   AnswerText.text = GameHelperManager.HelperInstance.TrueAnswerText.text.ToString();
                this.AnswerText.text = GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].Answer1;
            }
            else
            {
                this.AnswerText.text = GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].Answer2;
            }
        }

        //// Update is called once per frame
        //void Update()
        //{

        //}
        private void OnTriggerEnter(Collider other)
        {
            if (other.gameObject.CompareTag("Player"))
            {


               // Debug.Log("AnswerText.text :" +this.gameObject.GetComponent<AnswerObjectHandler>().AnswerText.text);
             //   Debug.Log("TrueAnswer.text :" + GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].TrueAnswer);
                if (this.gameObject.GetComponent<AnswerObjectHandler>().AnswerText.text ==
                        GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].TrueAnswer)
                {
                 //   Debug.Log("TruthAnswer");
                    ParticleHit.SetActive(true);
                    GameManager.GMInstance.DisableQuestion();

                    GameHelperManager.HelperInstance.XpSlider.GetComponent<Slider>().value += 0.5f;

                    GameManager.GMInstance.StartCoroutine(GameManager.GMInstance.ShowNotification(GameHelperManager.HelperInstance.AnswerTrueNotificationtext, 1f));

                    if (GameHelperManager.HelperInstance.dummyCount == GameManager.GMInstance.CurrentLevel)
                    {
                        GameManager.GMInstance.gameState = GameState.PreSuccess;
                        //   PlayerPrefs.SetInt("gameState", (int)gameState);
                        GameManager.GMInstance.UpdateGameState();
                    }
                    else
                    {
                        GameManager.GMInstance.gameState = GameState.DoorSpawn;
                        //   PlayerPrefs.SetInt("gameState", (int)gameState);
                        GameManager.GMInstance.UpdateGameState();
                    }

                    foreach (GameObject item in ObstaclePopulator.PoolerInst.TrueFalseObjects)
                    {
                        item.GetComponent<AnswerObjectHandler>().ParticleHit.SetActive(true);
                    
                    }
                    Invoke("DisableObject", 2.0f);
                }
                else if (this.gameObject.GetComponent<AnswerObjectHandler>().AnswerText.text !=
                        GameHelperManager.HelperInstance.questionAnswersList[GameHelperManager.HelperInstance.ActiveQuestionCount].TrueAnswer)
                {
                  //  Debug.Log("FalseAnswer");
                    ParticleHit.SetActive(true);

                    GameManager.GMInstance.DisableQuestion();
                    GameHelperManager.HelperInstance.XpSlider.GetComponent<Slider>().value -= 0.1f;

                    GameManager.GMInstance.StartCoroutine(GameManager.GMInstance.ShowNotification(GameHelperManager.HelperInstance.AnswerFalseNotificationtext, 1f));

                    if (GameHelperManager.HelperInstance.dummyCount == GameManager.GMInstance.CurrentLevel)
                    {
                        GameManager.GMInstance.gameState = GameState.PreFail;
                        //   PlayerPrefs.SetInt("gameState", (int)gameState);
                        GameManager.GMInstance.UpdateGameState();
                    }
                    else
                    {
                        GameManager.GMInstance.gameState = GameState.DoorSpawn;
                        //   PlayerPrefs.SetInt("gameState", (int)gameState);
                        GameManager.GMInstance.UpdateGameState();
                    }

                    foreach (GameObject item in ObstaclePopulator.PoolerInst.TrueFalseObjects)
                    {
                        item.GetComponent<AnswerObjectHandler>().ParticleHit.SetActive(true);
                       
                    }
                    Invoke("DisableObject", 1.0f);
                }



            }
        }

        public void DisableObject()
        {
            foreach (GameObject item in ObstaclePopulator.PoolerInst.TrueFalseObjects)
            {
         
                GameHelperManager.HelperInstance.ActiveTureFalseObjCount--;
                item.SetActive(false);
                item.transform.parent = null;

            }
        }

        private void OnDisable()
        {
            ParticleHit.SetActive(false);
        }
    }
}

